<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library | –ó–±–µ—Ä–µ–∂–µ–Ω–µ</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <header class="header">
        <div class="header-left">
            <span class="header-logo">Library</span>
            <nav class="main-nav">
                <a href="/home">–ì–æ–ª–æ–≤–Ω–∞</a>
                <a href="/home/catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
            </nav>
        </div>
        <div class="header-right">
            <a href="#" id="profile-link" class="btn-login" style="text-decoration: none;">–ü—Ä–æ—Ñ—ñ–ª—å</a>
        </div>
    </header>
    <aside id="profile-sidebar" class="profile-sidebar">
        <div class="sidebar-header">
            <h3>–ü—Ä–æ—Ñ—ñ–ª—å</h3>
            <button class="sidebar-close" id="sidebar-close">&times;</button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#">üìñ –ü—Ä–æ—á–∏—Ç–∞–Ω–µ</a>
            <a href="#">‚≠ê –ó–±–µ—Ä–µ–∂–µ–Ω–µ</a>
            <a href="/">üö™ –í–∏—Ö—ñ–¥</a>
        </nav>
        
        <div class="theme-switch-block">
            <span>–¢–µ–º–Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è</span>
            <label class="switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </aside>
    <div class="container catalog-layout">
        
        <main class="catalog-main" id="saved-container">
            <div class="catalog-header">
                <h2><span>–ó–±–µ—Ä–µ–∂–µ–Ω–µ</span></h2>
            </div>
            <div class="section-grid catalog-grid-page">

            {{#books}}
            <div class="manga-card">
                <a href="/preview/{{id}}">
                    <img src="{{image}}" alt="{{title}}">
                </a>
                    <div class="manga-card-info">
                        <h4>{{title}}</h4>
                        <p>{{genre}}</p>
                        <button class="btn-remove" data-book-id="{{id}}">–í–∏–ª—É—á–∏—Ç–∏</button>
                    </div>
            </div>
            {{/books}}
        </main>
            <div id="custom-context-menu" class="context-menu">
            <button id="context-menu-delete-btn" class="context-menu-btn">–í–∏–ª—É—á–∏—Ç–∏</button>
            </div>
    </div>

    <footer class="footer">
        <div class="container footer-content">
            <p>&copy; 2025 Library. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –ø–æ—Ä—Ç–∞–ª</p>
            <nav class="footer-nav">
                <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
                <a href="#">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a>
            </nav>
        </div>
    </footer>
    <script>
        document.getElementById('profile-link').addEventListener('click', function(event) {
            event.preventDefault();
            document.getElementById('profile-sidebar').classList.toggle('open');
        });

        document.getElementById('sidebar-close').addEventListener('click', function() {
            document.getElementById('profile-sidebar').classList.remove('open');
        });
        
        document.getElementById('theme-toggle').addEventListener('change', function() {
            document.body.classList.toggle('dark-theme', this.checked);
            
            localStorage.setItem('theme', this.checked ? 'dark' : 'light');
        });

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-theme');
            document.getElementById('theme-toggle').checked = true;
        }

document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('saved-container');
    const contextMenu = document.getElementById('custom-context-menu');
    const contextMenuDeleteBtn = document.getElementById('context-menu-delete-btn');

    if (!container || !contextMenu || !contextMenuDeleteBtn) {
        return;
    }

    function deleteBook(bookId) {
        fetch(`/saved/delete/${bookId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + data.message);
            }
        })
        .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞:', error));
    }

    container.addEventListener('contextmenu', function(event) {
        const card = event.target.closest('.manga-card');
        if (card) {
            event.preventDefault(); 

            const deleteButton = card.querySelector('[data-book-id]');
            if (!deleteButton) return;
            
            const bookId = deleteButton.dataset.bookId;
            contextMenuDeleteBtn.dataset.bookId = bookId;
            const cardRect = card.getBoundingClientRect();
            const topPosition = cardRect.top + cardRect.height / 2 + window.scrollY;
            const leftPosition = cardRect.left + cardRect.width / 2 + window.scrollX;
            contextMenu.style.top = `${topPosition}px`;
            contextMenu.style.left = `${leftPosition}px`;
            contextMenu.style.display = 'block'; 
        }
    });

    document.addEventListener('click', function(event) {
        if (event.target.id === 'context-menu-delete-btn') {
            const bookId = event.target.dataset.bookId;
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–ª—É—á–∏—Ç–∏ —Ü—é –∫–Ω–∏–≥—É?')) {
                deleteBook(bookId);
            }
        }
        
        if (!contextMenu.contains(event.target)) {
            contextMenu.style.display = 'none';
        }
    });
});
    </script>
</body>
</html>